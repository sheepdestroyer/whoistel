============================= test session starts ==============================
platform linux -- Python 3.14.2, pytest-9.0.1, pluggy-1.6.0
rootdir: /home/sheepdestroyer/LAB/whoistel
plugins: anyio-4.11.0
collected 15 items

tests/test_webapp.py ..........F....                                     [100%]

=================================== FAILURES ===================================
___________ test_report_validation_error_requires_at_least_one_field ___________

client = <FlaskClient <Flask 'webapp'>>

    def test_report_validation_error_requires_at_least_one_field(client):
        rv = client.post('/report', data={
            'number': '0123456789',
            'is_spam': '',
            'comment': '',
            'date': '',
        }, follow_redirects=True)
    
        # Should redirect back to the view page for that number
        assert b'0123456789' in rv.data
        # Should flash an error about needing at least spam/comment/date
>       assert b'au moins' in rv.data or b'cocher spam' in rv.data
E       assert (b'au moins' in b'<!DOCTYPE html>\n<html lang="fr">\n\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=de...     <input type="submit" value="Enregistrer le signalement">\n    </div>\n</form>\n\n\n    </div>\n</body>\n\n</html>' or b'cocher spam' in b'<!DOCTYPE html>\n<html lang="fr">\n\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=de...     <input type="submit" value="Enregistrer le signalement">\n    </div>\n</form>\n\n\n    </div>\n</body>\n\n</html>')
E        +  where b'<!DOCTYPE html>\n<html lang="fr">\n\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=de...     <input type="submit" value="Enregistrer le signalement">\n    </div>\n</form>\n\n\n    </div>\n</body>\n\n</html>' = <WrapperTestResponse 2486 bytes [200 OK]>.data
E        +  and   b'<!DOCTYPE html>\n<html lang="fr">\n\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=de...     <input type="submit" value="Enregistrer le signalement">\n    </div>\n</form>\n\n\n    </div>\n</body>\n\n</html>' = <WrapperTestResponse 2486 bytes [200 OK]>.data

tests/test_webapp.py:124: AssertionError
---------------------------- Captured stderr setup -----------------------------
Initializing history database schema in /tmp/tmp2wlcgd2h...
------------------------------ Captured log setup ------------------------------
INFO     history_manager:history_manager.py:32 Initializing history database schema in /tmp/tmp2wlcgd2h...
=========================== short test summary info ============================
FAILED tests/test_webapp.py::test_report_validation_error_requires_at_least_one_field
========================= 1 failed, 14 passed in 0.14s =========================
